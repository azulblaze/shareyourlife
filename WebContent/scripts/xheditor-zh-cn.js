/*
 * xhEditor - WYSIWYG XHTML Editor
 * @requires jQuery v1.3.2
 * 
 * @author Yanis.Wang<yanis.wang@gmail.com>
 * @site http://pirate9.com/
 * @licence LGPL(http://www.opensource.org/licenses/lgpl-license.php)
 * 
 * @Version: 1.0.0 beta build 091209
 */
(function(h){h.fn.xheditor=function(i,s){return this.each(function(){if(this.tagName.toLowerCase()!="textarea"){return}if(i){if(!this.xheditor){var I=new h.xheditor(this,s);if(I.init()){this.xheditor=I}else{I=null}}}else{if(this.xheditor){this.xheditor.remove();this.xheditor=null}}})};var k=0,r=h.browser.msie,l=h.browser.mozilla,G=h.browser.safari,t=false;var d,B,p,j;var E,C;E=window.location.href.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]*$/,"");E+="/";var F=h("script[src*=xheditor]"),o;for(var z=0;z<F.length;z++){o=F[z].src;if(o.match(/xheditor[^\/]*\.js/i)){C=o.replace(/[\?#].*$/,"").replace(/(^|[\/\\])[^\/]*$/,"");if(C!=""){C+="/"}break}}var D={27:"esc",9:"tab",32:"space",13:"return",8:"backspace",145:"scroll",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"del",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12"};var m=["#FFFFFF","#E5E4E4","#D9D8D8","#C0BDBD","#A7A4A4","#8E8A8B","#827E7F","#767173","#5C585A","#000000","#FEFCDF","#FEF4C4","#FEED9B","#FEE573","#FFED43","#F6CC0B","#E0B800","#C9A601","#AD8E00","#8C7301","#FFDED3","#FFC4B0","#FF9D7D","#FF7A4E","#FF6600","#E95D00","#D15502","#BA4B01","#A44201","#8D3901","#FFD2D0","#FFBAB7","#FE9A95","#FF7A73","#FF483F","#FE2419","#F10B00","#D40A00","#940000","#6D201B","#FFDAED","#FFB7DC","#FFA1D1","#FF84C3","#FF57AC","#FD1289","#EC0078","#D6006D","#BB005F","#9B014F","#FCD6FE","#FBBCFF","#F9A1FE","#F784FE","#F564FE","#F546FF","#F328FF","#D801E5","#C001CB","#8F0197","#E2F0FE","#C7E2FE","#ADD5FE","#92C7FE","#6EB5FF","#48A2FF","#2690FE","#0162F4","#013ADD","#0021B0","#D3FDFF","#ACFAFD","#7CFAFF","#4AF7FE","#1DE6FE","#01DEFF","#00CDEC","#01B6DE","#00A0C2","#0084A0","#EDFFCF","#DFFEAA","#D1FD88","#BEFA5A","#A8F32A","#8FD80A","#79C101","#3FA701","#307F00","#156200","#D4C89F","#DAAD88","#C49578","#C2877E","#AC8295","#C0A5C4","#969AC2","#92B7D7","#80ADAF","#9CA53B"];var A=[{n:"p",t:"普通段落"},{n:"h1",t:"标题1"},{n:"h2",t:"标题2"},{n:"h3",t:"标题3"},{n:"h4",t:"标题4"},{n:"h5",t:"标题5"},{n:"h6",t:"标题6"},{n:"pre",t:"已编排格式"},{n:"address",t:"地址"}];var c=["宋体","黑体","楷体","隶书","幼圆","微软雅黑","Arial","Arial Narrow","Arial Black","Comic Sans MS","Courier New","System","Times New Roman","Tahoma","Verdana"];var w=[{n:"xx-small",wkn:"x-small",s:"8pt",t:"极小"},{n:"x-small",wkn:"small",s:"10pt",t:"特小"},{n:"small",wkn:"medium",s:"12pt",t:"小"},{n:"medium",wkn:"large",s:"14pt",t:"中"},{n:"large",wkn:"x-large",s:"18pt",t:"大"},{n:"x-large",wkn:"xx-large",s:"24pt",t:"特大"},{n:"xx-large",wkn:"-webkit-xxx-large",s:"36pt",t:"极大"}];var e=[{s:"左对齐",v:"justifyleft",t:"左对齐"},{s:"居中",v:"justifycenter",t:"居中"},{s:"右对齐",v:"justifyright",t:"右对齐"},{s:"两端对齐",v:"justifyfull",t:"两端对齐"}],f=[{s:"数字列表",v:"insertOrderedList",t:"数字列表"},{s:"符号列表",v:"insertUnorderedList",t:"符号列表"}];var a='<div>使用键盘快捷键(Ctrl+V)把内容粘贴到方框里，按 确定</div><div><textarea id="xhEdtPastetextValue" wrap="soft" spellcheck="false" style="width:300px;height:100px;" /></div><div style="text-align:right;"><input type="button" id="xhEdtSave" value="确定" /></div>';var b='<div>链接地址: <input type="text" id="xhEdtLinkHref" value="http://" class="text" /></div><div>打开方式: <select id="xhEdtLinkTarget"><option selected="selected" value="">默认</option><option value="_blank">新窗口</option><option value="_self">当前窗口</option><option value="_parent">父窗口</option></select></div><div style="text-align:right;"><input type="button" id="xhEdtSave" value="确定" /></div>';var y='<div>图片地址：<input type="text" id="xhEdtImgSrc" value="http://" class="text" /></div><div>替换文本：<input type="text" id="xhEdtImgAlt" /></div><div>对齐方式：<select id="xhEdtImgAlign"><option selected="selected" value="">默认</option><option value="left">左对齐</option><option value="right">右对齐</option><option value="top">顶端</option><option value="middle">居中</option><option value="baseline">基线</option><option value="bottom">底边</option></select></div><div>宽度高度：<input type="text" id="xhEdtImgWidth" style="width:40px;" /> x <input type="text" id="xhEdtImgHeight" style="width:40px;" /></div><div>边框大小：<input type="text" id="xhEdtImgBorder" style="width:40px;" /></div><div>水平间距：<input type="text" id="xhEdtImgHspace" style="width:40px;" /> 垂直间距：<input type="text" id="xhEdtImgVspace" style="width:40px;" /></div><div style="text-align:right;"><input type="button" id="xhEdtSave" value="确定" /></div>';var H='<div>动画地址：<input type="text" id="xhEdtFlashSrc" value="http://" class="text" /></div><div>宽度高度：<input type="text" id="xhEdtFlashWidth" style="width:40px;" value="480" /> x <input type="text" id="xhEdtFlashHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><input type="button" id="xhEdtSave" value="确定" /></div>';var x='<div>视频地址：<input type="text" id="xhEdtMediaSrc" value="http://" class="text" /></div><div>宽度高度：<input type="text" id="xhEdtMediaWidth" style="width:40px;" value="480" /> x <input type="text" id="xhEdtMediaHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><input type="button" id="xhEdtSave" value="确定" /></div>';var g='<div>行数列数：<input type="text" id="xhEdtTableRows" style="width:40px;" value="3" /> x <input type="text" id="xhEdtTableColumns" style="width:40px;" value="2" /></div><div>标题单元：<select id="xhEdtTableHeaders"><option selected="selected" value="">无</option><option value="row">第一行</option><option value="col">第一列</option><option value="both">第一行和第一列</option></select></div><div>宽度高度：<input type="text" id="xhEdtTableWidth" style="width:40px;" value="200" /> x <input type="text" id="xhEdtTableHeight" style="width:40px;" value="" /></div><div>边框大小：<input type="text" id="xhEdtTableBorder" style="width:40px;" value="1" /></div><div>表格间距：<input type="text" id="xhEdtTableCellSpacing" style="width:40px;" value="1" /> 表格填充：<input type="text" id="xhEdtTableCellPadding" style="width:40px;" value="1" /></div><div>对齐方式：<select id="xhEdtTableAlign"><option selected="selected" value="">默认</option><option value="left">左对齐</option><option value="center">居中</option><option value="right">右对齐</option></select></div><div>表格标题：<input type="text" id="xhEdtTableCaption" /></div><div style="text-align:right;"><input type="button" id="xhEdtSave" value="确定" /></div>';var q='<div style="width:200px;word-wrap:break-word;word-break:break-all;"><p><span style="font-size:20px;color:#1997DF;">xhEditor</span><br />版本：v1.0.0 beta build 091209</p><p>xhEditor是一个基于jQuery开发的跨平台开源迷你XHTML编辑器组件。</p><p><a href="http://xheditor.com/" target="_blank">http://xheditor.com/</a></p></div>';var n=[{t:"Big grin",s:"biggrin.gif"},{t:"Smile",s:"smile.gif"},{t:"Titter",s:"titter.gif"},{t:"Lol",s:"lol.gif"},{t:"Call",s:"call.gif"},{t:"Victory",s:"victory.gif"},{t:"Shy",s:"shy.gif"},{t:"Handshake",s:"handshake.gif"},{t:"Kiss",s:"kiss.gif"},{t:"Sad",s:"sad.gif"},{t:"Cry",s:"cry.gif"},{t:"Huffy",s:"huffy.gif"},{t:"Mad",s:"mad.gif"},{t:"Tongue",s:"tongue.gif"},{t:"Sweat",s:"sweat.gif"},{t:"Shocked",s:"shocked.gif"},{t:"Time",s:"time.gif"},{t:"Hug",s:"hug.gif"}];var v={GStart:{},GEnd:{},Separator:{},Cut:{t:"剪切 (Ctrl+X)"},Copy:{t:"复制 (Ctrl+C)"},Paste:{t:"粘贴 (Ctrl+V)"},Pastetext:{t:"粘贴文本"},Blocktag:{t:"段落标签"},Fontface:{t:"字体"},FontSize:{t:"字号"},Bold:{t:"加粗 (Ctrl+B)",s:"Ctrl+B"},Italic:{t:"斜体 (Ctrl+I)",s:"Ctrl+I"},Underline:{t:"下划线 (Ctrl+U)",s:"Ctrl+U"},Strikethrough:{t:"中划线 (Ctrl+S)",s:"Ctrl+S"},FontColor:{t:"字体颜色"},BackColor:{t:"背景颜色"},Removeformat:{t:"删除文字格式"},Align:{t:"对齐"},List:{t:"列表"},Outdent:{t:"减少缩进 (Shift+Tab)",s:"Shift+Tab"},Indent:{t:"增加缩进 (Tab)",s:"Tab"},Link:{t:"超链接"},Unlink:{t:"取消超链接"},Img:{t:"图片"},Flash:{t:"Flash动画"},Media:{t:"视频"},Emot:{t:"表情"},Table:{t:"表格"},Source:{t:"源代码"},Preview:{t:"预览"},Fullscreen:{t:"全屏编辑 (Esc)",s:"Esc"},About:{t:"关于 xhEditor"}};var u={mini:"GStart,Bold,Italic,Underline,Strikethrough,GEnd,Separator,GStart,Align,List,GEnd,Separator,GStart,Link,Img,About,GEnd",simple:"GStart,Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,GEnd,Separator,GStart,Align,List,Outdent,Indent,GEnd,Separator,GStart,Link,Img,Emot,About,GEnd",full:"GStart,Cut,Copy,Paste,Pastetext,GEnd,Separator,GStart,Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,Removeformat,GEnd,Separator,GStart,Align,List,Outdent,Indent,GEnd,Separator,GStart,Link,Unlink,Img,Flash,Media,Emot,Table,GEnd,Separator,GStart,Source,Preview,Fullscreen,About,GEnd"};h.xheditor=function(X,M){var U={skin:"default",tools:"full",internalScript:false,inlineScript:false,internalStyle:false,inlineStyle:true,showBlocktag:false,forcePtag:true,keepValue:true,upLinkExt:"zip,rar,txt",upImgExt:"jpg,jpeg,gif,png",upFlashExt:"swf",upMediaExt:"avi",modalWidth:350,modalHeight:220,modalTitle:true,baseUrl:E,attachLinkText:"点击打开链接"};var ad=this,K=X,ae=h(K),R=ae.closest("form"),V,T,al,L,ab;var S;var W=false,P=false,I=false,ak=false,aa=false,s=false,Z="",ai;var ah=0,aj=0;this.settings=h.extend({},U,M);if(ad.settings.plugins){v=h.extend({},v,ad.settings.plugins)}if(ad.settings.tools.match(/^\s*(mini|simple|full)\s*$/i)){ad.settings.tools=h.trim(ad.settings.tools);ad.settings.tools=u[ad.settings.tools]}if(!ad.settings.tools.match(/(^|,)\s*About\s*(,|$)/i)){ad.settings.tools+=",About"}ad.settings.tools=ad.settings.tools.split(",");var O="xhEdtCSS_"+ad.settings.skin,ac="xhEdt"+k+"_container",i="xhEdt"+k+"_Tool",Y="xhEdt"+k+"_iframearea",ag="xhEdt"+k+"_iframe";var af="",J=C+"xheditor_skin/"+ad.settings.skin+"/";s=ad.settings.showBlocktag;if(s){af+=" showBlocktag"}var N=[];this.init=function(){if(h("#"+O).size()==0){h("head").append('<link id="'+O+'" rel="stylesheet" type="text/css" href="'+J+'ui.css" />')}var am=ad.settings.width||K.style.width||ae.width();aj=ad.settings.height||ae.height();if(/^[0-9\.]+$/i.test(""+am)){am+="px"}var ap="",an,ao=1;h.each(ad.settings.tools,function(at,av){an=v[av];if(av=="GStart"){ap+='<span class="xhEdtGStart"/>'}else{if(av=="GEnd"){ap+='<span class="xhEdtGEnd"/>'}else{if(av=="Separator"){ap+='<span class="xhEdtSeparator"/>'}else{if(av=="BtnBr"){ap+="<br />";ao++}else{var au;if(an.c){au=an.c}else{au="xhEdtIcon xhEdtBtn"+av}ap+='<span><a href="javascript:void(0);" title="'+an.t+'" name="'+av+'" class="xhEdtButton xhEdtEnabled"><span class="'+au+'" /></a></span>';if(an.s){ad.addShortCut(an.s,av)}}}}}});ah=ao*24+2;ap+="<br />";if((aj-ah)<16){aj=ah+16}ae.after(h('<span id="'+ac+'" class="xhEdt_'+ad.settings.skin+'" style="display:none"><table cellspacing="0" cellpadding="0" class="xhEdtLayout" style="width:'+am+";height:"+aj+'px;"><tbody><tr><td id="'+i+'" class="xhEdtTool" style="height:'+ah+'px"></td></tr><tr><td id="'+Y+'" class="xhEdtIframeArea" style="height:'+(aj-ah)+'px"><iframe frameborder="0" id="'+ag+'" src="javascript:void(0);" style="width:100%;"></iframe></td></tr></tbody></table></span>'));var aq='<html><head><base target="_blank"'+(ad.settings.baseUrl!=E?' href="'+ad.settings.baseUrl+'"':"")+' /><meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/><link rel="stylesheet" href="'+J+'iframe.css"/>';if(ad.settings.loadCSS){aq+='<link rel="stylesheet" href="'+ad.settings.loadCSS+'"/>'}aq+='</head><body spellcheck="false" dir="ltr" class="editMode'+af+'"></body></html>';T=h("#"+ag)[0].contentWindow;al=h(T);try{L=T.document;ab=h(L);L.open();L.write(aq);L.close();if(r){L.body.contentEditable="true"}else{L.designMode="On"}}catch(ar){}setTimeout(ad.setOpts,300);ad.setSource();T.setInterval=null;V=h("#"+i).append(ap);V.find(".xhEdtButton").click(function(au){ad.hidePanel();ad.focus();ai=au;var at=h(this);if(at.is(".xhEdtEnabled")){ad.exec(at.attr("name"))}return false}).mousedown(function(){return false});d=h("#xhEdtPanel");B=h("#xhEdtShadow");p=h("#xhEdtCntLine");if(d.size()==0){d=h('<div id="xhEdtPanel"></div>').mousedown(function(at){at.stopPropagation()});B=h('<div id="xhEdtShadow"></div>');p=h('<div id="xhEdtCntLine"><img src="'+J+'img/spacer.gif" /></div>');h(document.body).append(d).append(B).append(p)}h(document).mousedown(ad.hidePanel);ab.mousedown(ad.hidePanel);h("#"+ac).show();ae.hide();ad.bind();k++;W=true;if(ad.settings.fullscreen){ad.toggleFullscreen()}if(ad.settings.readonly){ad.toggleReadonly(true)}else{if(ad.settings.sourceMode){setTimeout(ad.toggleSource,20)}}return true};this.remove=function(){ad.unbind();h("#"+ac).remove();ae.show();W=false};this.bind=function(){ae.focus(ad.focus);R.submit(ad.getSource).bind("reset",ad.setSource);var am=h(window);am.unload(ad.getSource).bind("beforeunload",ad.getSource);am.resize(ad.fixFullHeight);al.focus(function(){if(ad.settings.focus){ad.settings.focus()}}).blur(function(){if(ad.settings.blur){ad.settings.blur()}});if(G){al.click(ad.fixAppleSel)}ab.keydown(ad.checkShortCut).keydown(ad.forcePtag)};this.unbind=function(){ae.unbind("focus",ad.focus);R.unbind("submit",ad.getSource).unbind("reset",ad.setSource);var am=h(window);am.unbind("unload",ad.getSource).unbind("beforeunload",ad.getSource);am.unbind("resize",ad.fixFullHeight);if(G){al.unbind("click",ad.fixAppleSel)}ab.unbind("keydown",ad.checkShortCut).unbind("keydown",ad.forcePtag)};this.setCSS=function(am){try{ad._exec("styleWithCSS",am)}catch(an){try{ad._exec("useCSS",!am)}catch(an){}}};this.setOpts=function(){if(W&&!I&&!P){ad.setCSS(false);try{ad._exec("enableObjectResizing",true)}catch(am){}try{ad._exec("enableInlineTableEditing",false)}catch(am){}if(r){try{ad._exec("BackgroundImageCache",true)}catch(am){}}}};this.forcePtag=function(an){if(P||I||an.keyCode!=13||an.shiftKey||an.ctrlKey||an.altKey){return true}var am=ad.getParent("p,h1,h2,h3,h4,h5,h6,pre,address,div,li");if(ad.settings.forcePtag){if(am.size()==0){ad._exec("formatblock","<p>")}}else{ad.pasteHTML("<br />");return false}};this.fixFullHeight=function(){if(!l&&!G){var am=h("#"+Y);am.height("100%");if(ak){am.height((am.height()-ah)+"px")}if(r){V.hide().show()}}};this.fixAppleSel=function(ao){ao=ao.target;if(ao.tagName.match(/(img|embed)/i)){var an=ad.getSel(),am=L.createRange();am.selectNode(ao);an.removeAllRanges();an.addRange(am)}};this.focus=function(){if(!P){al.focus()}else{h("#sourceCode",L).focus()}if(r&&!P&&S){S.select();S=null}return false};this.getSel=function(){return T.getSelection?T.getSelection():L.selection};this.getRng=function(){var ao=ad.getSel(),am;try{am=ao.rangeCount>0?ao.getRangeAt(0):(ao.createRange?ao.createRange():L.createRange())}catch(an){}if(!am){am=r?L.body.createTextRange():L.createRange()}return am};this.getParent=function(am){var an=ad.getRng(),ao;if(!r){ao=an.commonAncestorContainer;if(!an.collapsed){if(an.startContainer==an.endContainer&&an.startOffset-an.endOffset<2&&an.startContainer.hasChildNodes()){ao=an.startContainer.childNodes[an.startOffset]}}}else{ao=an.item?an.item(0):an.parentElement()}am=am?am:"*";ao=h(ao);if(!ao.is(am)){ao=h(ao).closest(am)}return ao};this.getSelect=function(aq){var ap=ad.getSel(),am=ad.getRng(),an=true;if(!am||am.item){an=false}else{an=!ap||am.boundingWidth==0||am.collapsed}if(aq=="text"){return an?"":(am.text||(ap.toString?ap.toString():""))}var ar;if(am.cloneContents){var ao=h("<div></div>"),at;at=am.cloneContents();if(at){ao.append(at)}ar=ao.html()}else{if(Q(am.item)){ar=am.item(0).outerHTML}else{if(Q(am.htmlText)){ar=am.htmlText}else{ar=am.toString()}}}ar=ad.processHTML(ar,"read");ar=ad.cleanHTML(ar);ar=ad.formatXHTML(ar);return ar};function Q(an,am){var ao=typeof(an);if(!am){return ao!="undefined"}if(am=="array"&&(an.hasOwnProperty&&an instanceof Array)){return true}return ao==am}this.pasteHTML=function(ap){if(P||I){return false}ad.focus();ap=ad.processHTML(ap,"write");var am=ad.getRng();ap+='<span id="__caret" />';if(am.insertNode){am.deleteContents();am.insertNode(am.createContextualFragment(ap))}else{am.pasteHTML(ap)}var an=h("#__caret",L),aq=an[0],ao=ad.getSel();if(r){am.moveToElementText(aq);am.select()}else{am.selectNode(aq);ao.removeAllRanges();ao.addRange(am)}an.remove()};this.pasteText=function(am){if(!am){am=""}am=ad.domEncode(am);am=am.replace(/\r?\n/g,"<br>");ad.pasteHTML(am)};this.appendHTML=function(am){if(P||I){return false}ad.focus();am=ad.processHTML(am,"write");h(L.body).append(am)};this.domEncode=function(an){if(an){var am={"<":"&lt;",">":"&gt;"};an=an.replace(/[<>]/g,function(ao){return am[ao]})}return an};this.setSource=function(am){setTimeout(function(){ad._setSource(am)},10)};this._setSource=function(am){S=null;if(typeof am!="string"&&am!=""){am=ae.val()}if(P){h("#sourceCode",L).val(am)}else{if(ad.settings.beforeSetSource){am=ad.settings.beforeSetSource(am)}am=ad.formatXHTML(am);h(L.body)[0].innerHTML=ad.processHTML(am,"write")}};this.processHTML=function(au,at){var ap=' class="Apple-style-span"';if(at=="write"){if(ad.settings.keepValue){function am(ay,av,ax,aB,az,aw,aA){ax+=" _xhe_"+aB+'="'+aw+'"';return"<"+av+ax+" "+aA+">"}au=au.replace(/<(\w+(?:\:\w+)?)(\s+[^>]*?(src|href)\s*=\s*(['"]?)\s*([^'"\s]*)\s*\4[^\/>]*?)(\/?)>/ig,am)}au=au.replace(/<(\/?)del( [^>]+)?>/ig,"<$1strike$2>");if(l){au=au.replace(/<(\/?)strong( [^>]+)?>/ig,"<$1b$2>");au=au.replace(/<(\/?)em( [^>]+)?>/ig,"<$1i$2>")}else{if(G){au=au.replace(/("|;)\s*font-size\s*:\s*([a-z-]+)(;?)/ig,function(az,aB,av,aA){var ax,ay;for(var aw=0;aw<w.length;aw++){ax=w[aw];if(av==ax.n){ay=ax.wkn;break}}return aB+"font-size:"+ay+aA});au=au.replace(/<strong( [^>]+)?>/ig,"<span"+ap+' style="font-weight: bold;"$1>');au=au.replace(/<em( [^>]+)?>/ig,"<span"+ap+' style="font-style: italic;"$1>');au=au.replace(/<u( [^>]+)?>/ig,"<span"+ap+' style="text-decoration: underline;"$1>');au=au.replace(/<strike( [^>]+)?>/ig,"<span"+ap+' style="text-decoration: line-through;"$1>');au=au.replace(/<\/(strong|em|u|strike)>/ig,"</span>");au=au.replace(/<span((?:\s+[^>]+)?\s+style="([^"]*;)*\s*(font-family|font-size|color|background-color)\s*:\s*[^;"]+\s*;?"[^>]*)>/ig,"<span"+ap+"$1>")}else{if(r){au=au.replace(/&apos;/ig,"&#39;");au=au.replace(/\s+(disabled|checked|readonly|selected)\s*=\s*[\"\']?(false|0)[\"\']?/ig,"")}}}au=au.replace(/<a(\s+[^>]+)?\/>/,"<a$1></a>");if(!G){function aq(aB,aF,av,ay){var aE="",ax,aD,aC,aA;ax=av.match(/font-family\s*:\s*([^;"]+)/i);if(ax){aE+=' face="'+ax[1]+'"'}aD=av.match(/font-size\s*:\s*([^;"]+)/i);if(aD){aD=aD[1].toLowerCase();for(var aw=0;aw<w.length;aw++){if(aD==w[aw].n||aD==w[aw].s){aC=aw+1;break}}if(aC){aE+=' size="'+aC+'"';av=av.replace(/(^|;)(\s*font-size\s*:\s*[^;"]+;?)+/ig,"$1")}}aA=av.match(/(?:^|[\s;])color\s*:\s*([^;"]+)/i);if(aA){var az;if(az=aA[1].match(/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i)){az=Number(az[1])*65536+Number(az[2])*256+Number(az[3]);az=az.toString(16);while(az.length<6){az="0"+az}aA[1]="#"+az}else{if(az=aA[1].match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i)){aA[1]="#"+az[1]+az[1]+az[2]+az[2]+az[3]+az[3]}}aE+=' color="'+aA[1]+'"'}av=av.replace(/(^|;)(\s*(font-family|color)\s*:\s*[^;"]+;?)+/ig,"$1");if(aE!=""){if(av){aE+=' style="'+av+'"'}return"<font"+aE+">"+ay+"</font>"}else{return aB}}au=au.replace(/<(span)(?:\s+[^>]+)? style="((?:[^"]*?;)*\s*(?:font-family|font-size|color)\s*:[^"]*)"(?: [^>]+)?>(((?!<\1(\s+[^>]+)?>)[\s\S])*?)<\/\1>/ig,aq);au=au.replace(/<(span)(?:\s+[^>]+)? style="((?:[^"]*?;)*\s*(?:font-family|font-size|color)\s*:[^"]*)"(?: [^>]+)?>(((?!<\1(\s+[^>]+)?>)[\s\S]|<\1(\s+[^>]+)?>((?!<\1(\s+[^>]+)?>)[\s\S])*?<\/\1>)*?)<\/\1>/ig,aq);au=au.replace(/<(span)(?:\s+[^>]+)? style="((?:[^"]*?;)*\s*(?:font-family|font-size|color)\s*:[^"]*)"(?: [^>]+)?>(((?!<\1(\s+[^>]+)?>)[\s\S]|<\1(\s+[^>]+)?>((?!<\1(\s+[^>]+)?>)[\s\S]|<\1(\s+[^>]+)?>((?!<\1(\s+[^>]+)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,aq)}}else{if(ad.settings.keepValue){function an(ay,av,ax,aA,az,aw){ax=ax.replace(new RegExp("\\s+"+aA+"\\s*=\\s*([\"']?)[^\"'\\s]*\\1","ig")," "+aA+'="'+aw.replace(/\$/g,"$$$$")+'"');return"<"+av+ax+">"}au=au.replace(/<(\w+(?:\:\w+)?)(\s+[^>]*?_xhe_(src|href)\s*=\s*(['"]?)\s*([^'"\s]*)\s*\4[^>]*)>/ig,an)}if(G){au=au.replace(/("|;)\s*font-size\s*:\s*([a-z-]+)(;?)/ig,function(az,aB,av,aA){var ax,ay;for(var aw=0;aw<w.length;aw++){ax=w[aw];if(av==ax.wkn){ay=ax.n;break}}return aB+"font-size:"+ay+aA});var ar=[{r:/font-weight:\sbold/ig,t:"strong"},{r:/font-style:\sitalic/ig,t:"em"},{r:/text-decoration:\sunderline/ig,t:"u"},{r:/text-decoration:\sline-through/ig,t:"strike"}];function ao(aB,aw,ay,ax,aC){var av=ay+ax,aA="";for(var az=0;az<ar.length;az++){if(av.match(ar[az].r)){aA=ar[az].t;break}}if(aA){return"<"+aA+">"+aC+"</"+aA+">"}else{return aB}}au=au.replace(/<(span)(\s+[^>]+|)? class="Apple-style-span"(\s+[^>]+|)?>(((?!<\1(\s+[^>]+)?>)[\s\S])*?)<\/\1>/ig,ao);au=au.replace(/<(span)(\s+[^>]+|)? class="Apple-style-span"(\s+[^>]+|)?>(((?!<\1(\s+[^>]+)?>)[\s\S]|<\1(\s+[^>]+)?>((?!<\1(\s+[^>]+)?>)[\s\S])*?<\/\1>)*?)<\/\1>/ig,ao);au=au.replace(/<(span)(\s+[^>]+|)? class="Apple-style-span"(\s+[^>]+|)?>(((?!<\1(\s+[^>]+)?>)[\s\S]|<\1(\s+[^>]+)?>((?!<\1(\s+[^>]+)?>)[\s\S]|<\1(\s+[^>]+)?>((?!<\1(\s+[^>]+)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,ao)}au=au.replace(/(\s+)(?:_xhe_|_moz_|_webkit_)[^=]+?\s*=\s*(["']?)[^"'\s>]*\2\s*/ig,"$1");au=au.replace(/<(\w+[^>]*?)\s+class="?(?:apple|webkit)\-[^ >]*([^>]*?)>/ig,"<$1$2>")}return au};this.getSource=function(){var am;if(P){am=h("#sourceCode",L).val()}else{am=ad.processHTML(h(L.body).html(),"read");am=ad.cleanWord(am);am=ad.cleanHTML(am);am=ad.formatXHTML(am);if(ad.settings.beforeGetSource){am=ad.settings.beforeGetSource(am)}}ae.val(am);return am};this.cleanWord=function(am){if(am.match(/mso-|MsoNormal/i)){am=am.replace(/<!--([\s\S]*?)-->|<style(\s+[^>]+)?>[\s\S]*?<\/style>/ig,"");am=am.replace(/<\/?\w+:[^>]*>/ig,"");am=am.replace(/<(\w+[^>]*?)\s+class="?mso[^ >]*([^>]*?)>/ig,"<$1$2>");am=am.replace(/<(\w+[^>]*?)\s+lang="?[^ \>]*([^>]*?)>/ig,"<$1$2>");am=am.replace(/<(\w+[^>]*?)\s+align="?left"?([^>]*?)>/ig,"<$1$2>");am=am.replace(/\s*mso-[^:]+:[^;"]+;?\s*/ig,"");am=am.replace(/\s*margin: 0cm 0cm 0pt\s*;\s*/ig,"");am=am.replace(/\s*margin: 0cm 0cm 0pt\s*"/ig,'"');am=am.replace(/\s*text-align:[^;"]+;?\s*/ig,"");am=am.replace(/\s*font-variant:[^;"]+;?\s*/ig,"");am=am.replace(/<(\w+[^>]*?)\s+style="?"?(\s+|>)/ig,"<$1$2");am=am.replace(/<(\w+[^>]*?)\s+style="?\s*([^">]+)\s*"?([^>]*?)>/ig,function(ap,ao,aq,an){return"<"+ao+' style="'+aq.replace(/&quot;/ig,"")+'"'+an+">"})}return am};this.cleanHTML=function(an){an=an.replace(/<\??xml(:\w+)?( [^>]+)?>([\s\S]*?<\/xml>)?/ig,"");an=an.replace(/<(meta|link)(\s+[^>]+)?>/ig,"");if(!ad.settings.internalScript){an=an.replace(/<(script)(\s+[^>]+)?>(((?!<\1(\s+[^>]+)?>)[\s\S]|<\1(\s+[^>]+)?>((?!<\1(\s+[^>]+)?>)[\s\S]|<\1(\s+[^>]+)?>((?!<\1(\s+[^>]+)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,"")}if(!ad.settings.inlineScript){an=an.replace(/<(\w+)(\s+[^>]+?)?\s+on(?:click|dblclick|mousedown|mouseup|mousemove|mouseover|mouseout|mouseenter|mouseleave|keydown|keypress|keyup|change|select|submit|reset|blur|focus|load|unload)\s*=\s*(["']?)[^"']*?\3(\s+[^>]+?)?>/ig,"<$1$2$4>")}if(!ad.settings.internalStyle){an=an.replace(/<(style)(\s+[^>]+)?>(((?!<\1(\s+[^>]+)?>)[\s\S]|<\1(\s+[^>]+)?>((?!<\1(\s+[^>]+)?>)[\s\S]|<\1(\s+[^>]+)?>((?!<\1(\s+[^>]+)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,"")}if(!ad.settings.inlineStyle){an=an.replace(/<(\w+)(\s+[^>]+?)?\s+style\s*=\s*(["']?)[^"']*?\3(\s+[^>]+?)?>/ig,"<$1$2$4>")}for(var am=0;am<3;am++){an=an.replace(/<(strong|b|u|del|strike|s|em|i)(?:\s+[^>]+)?>(((?!<\1(\s+[^>]+)?>)([ \t\r\n]|&nbsp;))*?)<\/\1>/ig,function(ap,ao,aq){if(aq.match(/&nbsp;/i)){return aq.replace(/ +/g,"")}else{return""}})}an=an.replace(/<\/(strong|b|u|strike|em|i)>((?:\s|<br\/?>|&nbsp;)*?)<\1>/ig,"$2");an=an.replace(/<(p|div)(?:\s+[^>]+)?>(((?!<\1(?: [^>]+)?>)[\s\S])+?)<\/\1>/ig,function(aq,ao,ar){var ap=ar.replace(/<\/?(span|strong|b|u|strike|em|i)(\s+[^>]+)?>/ig,"");ap=ap.replace(/([ \t\r\n]|&nbsp;)+/ig,"");if(ap!=""){return aq}else{return"<"+ao+"></"+ao+">"}});an=an.replace(/^(\r?\n)+/g,"");an=an.replace(/(\r?\n)+/g,"\r\n");an=an.replace(/\s+$/g,"");return an};this.formatXHTML=function(az){var av=ay("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed");var ao=ay("address,applet,blockquote,button,center,dd,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul");var am=ay("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,del,strong,sub,sup,textarea,tt,u,var");var aI=ay("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr");var aw=ay("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected");var aH=ay("script,style");var an={b:"strong",i:"em",s:"del",strike:"del"};var aE=/^<(\w+(?:\:\w+)?)((?:\s+[\w-\:]*(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/;var at=/^<\/(\w+(?:\:\w+)?)[^>]*>/;var aC=/([\w-(?:\:\w+)?]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g;var aq,aB=0,ap=[],au=az,ax="",aA=[];ap.last=function(){return this[this.length-1]};while(az){if(!ap.last()||!aH[ap.last()]){aB=0;if(az.indexOf("<!")==0){match=az.match(/^<!(?:--)?([\s\S]*?)(?:--)?>/);if(match){aB=match[0].length;aA.push("<!--"+match[1]+"-->")}else{aB=1}}else{if(az.indexOf("</")==0){match=az.match(at);if(match){aB=match[0].length;match[0].replace(at,aF)}else{aB=1}}else{if(az.indexOf("<")==0){match=az.match(aE);if(match){aB=match[0].length;match[0].replace(aE,aG)}else{aB=1}}}}if(aB==1){aA.push("&lt;")}if(aB>0){az=az.substring(aB)}else{aq=az.search(/<[^<>]+>/);ax=aq<0?az:az.substring(0,aq);az=aq<0?"":az.substring(aq);aA.push(ad.domEncode(ax))}}else{az=az.replace(/^([\s\S]*?)<\/(?:style|script)>/i,function(aJ,aK){aA.push(aK);return""});aF("",ap.last())}au=az}aF();az=aA.join("");function ay(aM){var aL={},aJ=aM.split(",");for(var aK=0;aK<aJ.length;aK++){aL[aJ[aK]]=true}return aL}function ar(aK){if(aK){aK=aK.toLowerCase();var aJ=an[aK];if(aJ){aK=aJ}}else{aK=""}return aK}function aG(aJ,aL,aM,aK){aL=ar(aL);if(ao[aL]){while(ap.last()&&am[ap.last()]){aF("",ap.last())}}if(aI[aL]&&ap.last()==aL){aF("",aL)}aK=av[aL]||!!aK;if(!aK){ap.push(aL)}aA.push("<"+aL);aM.replace(aC,function(aO,aN){aN=aN.toLowerCase();var aP=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:aw[aN]?aN:"";if(aP){aA.push(" "+aN+'="'+aP.replace(/(^|[^\\])"/g,'$1\\"')+'"')}});aA.push((aK?" /":"")+">")}function aF(aJ,aL){if(!aL){var aM=0}else{aL=ar(aL);for(var aM=ap.length-1;aM>=0;aM--){if(ap[aM]==aL){break}}}if(aM>=0){for(var aK=ap.length-1;aK>=aM;aK--){aA.push("</"+ap[aK]+">")}ap.length=aM}}function aD(aN,aR,aO,aL){var aP="",aK,aQ,aM,aJ;aK=aO.match(/ face\s*=\s*"\s*([^"]+)\s*"/i);if(aK){aP+="font-family:"+aK[1]+";"}aQ=aO.match(/ size\s*=\s*"\s*(\d+)\s*"/i);if(aQ){aP+="font-size:"+w[aQ[1]-1].n+";"}aM=aO.match(/ color\s*=\s*"\s*([^"]+)\s*"/i);if(aM){aP+="color:"+aM[1]+";"}aJ=aO.match(/ style\s*=\s*"\s*([^"]+)\s*"/i);if(aJ){aP+=aJ[1]}if(aP){aL='<span style="'+aP+'">'+aL+"</span>"}return aL}az=az.replace(/<(font)(\s+[^>]+|)?>(((?!<\1(\s+[^>]+)?>)[\s\S])*?)<\/\1>/ig,aD);az=az.replace(/<(font)(\s+[^>]+|)?>(((?!<\1(\s+[^>]+)?>)[\s\S]|<\1(\s+[^>]+)?>((?!<\1(\s+[^>]+)?>)[\s\S])*?<\/\1>)*?)<\/\1>/ig,aD);az=az.replace(/<(font)(\s+[^>]+|)?>(((?!<\1(\s+[^>]+)?>)[\s\S]|<\1(\s+[^>]+)?>((?!<\1(\s+[^>]+)?>)[\s\S]|<\1(\s+[^>]+)?>((?!<\1(\s+[^>]+)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,aD);return az};this.toggleShowBlocktag=function(an){if(s===an){return}s=!s;var am=h(L.body);if(s){af+=" showBlocktag";am.addClass("showBlocktag")}else{af=af.replace(" showBlocktag","");am.removeClass("showBlocktag")}};this.toggleReadonly=function(am){if(aa===am){return}if(P){ad.toggleSource(true)}aa=!aa;if(aa){if(!I){ad.togglePreview(true)}V.find("[name=Preview]").toggleClass("xhEdtEnabled").toggleClass("xhEdtActive")}else{V.find("[name=Preview]").toggleClass("xhEdtEnabled").toggleClass("xhEdtActive");if(I){ad.togglePreview()}}};this.toggleSource=function(an){if(I||P===an){return}V.find("[name=Source]").toggleClass("xhEdtEnabled").toggleClass("xhEdtActive");V.find(".xhEdtButton").not("[name=Source],[name=Fullscreen],[name=About]").toggleClass("xhEdtEnabled");if(t){ad.hidePanel()}var am=h(L.body),ao=ad.getSource();if(!P){if(r){L.body.contentEditable="false"}else{L.designMode="Off"}am.attr("scroll","no").attr("class","sourceMode").html('<textarea id="sourceCode" wrap="soft" spellcheck="false" height="100%" />');am.find("#sourceCode").blur(ad.getSource)}else{am.find("#sourceCode").remove();if(r){L.body.contentEditable="true"}else{L.designMode="On";if(l){ad._exec("inserthtml","-")}}am.removeAttr("scroll").attr("class","editMode"+af);setTimeout(function(){T.scrollTo(0,0)},10)}P=!P;ad._setSource(ao);V.find("[name=Source]").toggleClass("xhEdtEnabled");setTimeout(ad.setOpts,300)};this.togglePreview=function(an){if(P||I===an){return}V.find("[name=Preview]").toggleClass("xhEdtActive").toggleClass("xhEdtEnabled");V.find(".xhEdtButton").not("[name=Preview],[name=Fullscreen],[name=About]").toggleClass("xhEdtEnabled");var am=h(L.body);if(!I){if(r){L.body.contentEditable="false"}else{L.designMode="Off"}am.attr("class","previewMode");am[0].innerHTML=am.html()}else{if(r){L.body.contentEditable="true"}else{L.designMode="On"}am.attr("class","editMode"+af);am[0].innerHTML=am.html()}I=!I;V.find("[name=Preview]").toggleClass("xhEdtEnabled");setTimeout(ad.setOpts,300)};this.toggleFullscreen=function(ap){if(ak===ap){return}if(t){ad.hidePanel()}var an=h("#"+Y),ao=h("#"+ac).find(".xhEdtLayout"),am=h("#"+ac);if(ak){if(h.boxModel===false){ae.after(am)}ao.attr("style",Z);an.height(aj-ah)}else{if(h.boxModel===false){h("body").append(am)}Z=ao.attr("style");ao.removeAttr("style");an.height("100%");setTimeout(ad.fixFullHeight,100)}ak=!ak;am.toggleClass("xhEdt_Fullscreen");h("html").toggleClass("xhEdt_Fullfix");V.find("[name=Fullscreen]").toggleClass("xhEdtActive");setTimeout(ad.setOpts,300)};this.addShortCut=function(am,an){N[am.toLowerCase()]=an};this.checkShortCut=function(ao){if(P||I){return true}ai=ao;var an=ai.which,am=D[an],ap=am?am:String.fromCharCode(an).toLowerCase();sKey="";sKey+=ai.ctrlKey?"ctrl+":"";sKey+=ai.altKey?"alt+":"";sKey+=ai.shiftKey?"shift+":"";sKey+=ap;if(N[sKey]){ad.exec(N[sKey]);return false}};this.showMenu=function(ao,ap){var an=h('<div class="xhEdtMenu"></div>'),am;h.each(ao,function(ar,aq){am=h('<a href="javascript:void(0);" title="'+aq.t+'">'+aq.s+"</a>").click(function(){ad.focus();ap(aq.v);ad.hidePanel();return false}).mousedown(function(){return false});an.append(am)});ad.showPanel(an)};this.showColor=function(aq){var an=h('<div class="xhEdtColor"></div>'),ao,am,ap=0;ao=h("<div></div>");h.each(m,function(at,ar){ap++;am=h('<a href="javascript:void(0);" title="'+ar+'" style="background:'+ar+'"><img src="'+J+'img/spacer.gif" /></a>').click(function(){ad.focus();aq(ar);ad.hidePanel()}).mousedown(function(){return false});ao.append(am);if(ap%10==0){an.append(ao);ao=h("<div></div>")}});an.append(ao);ad.showPanel(an)};this.showPastetext=function(){var an=h(a);var ao=h("#xhEdtPastetextValue",an),am=h("#xhEdtSave",an);am.click(function(){ad.focus();var ap=ao.val();if(ap){ad.pasteText(ap)}ad.hidePanel();return false});ad.showDialog(an)};this.attr=function(ao,ap,am){if(!ap){return false}var an="_xhe_"+ap;if(am){ao.attr(ap,am);if(ad.settings.keepValue){ao.removeAttr(an).attr(an,am)}}am=ao.attr(ap);if(ad.settings.keepValue){am=ao.attr(an)||am}return am};this.showLink=function(){var an=h(b);var ao=ad.getParent("a"),aq=h("#xhEdtLinkHref",an),ap=h("#xhEdtLinkTarget",an),am=h("#xhEdtSave",an);if(ao.size()==1){aq.val(ad.attr(ao,"href"));ap.attr("value",ao.attr("target"))}if(ad.settings.upLinkUrl){ad.ajaxUploadInit(aq,ad.settings.upLinkUrl,ad.settings.upLinkExt)}am.click(function(){ad.focus();var ar=aq.val();if(ar==""||ao.size()==0){ad._exec("unlink")}if(ar!=""&&ar!="http://"){if(ao.size()==0){if(ad.getSelect("text")==""){ad.pasteHTML('<a href="#xhedt_tempurl">'+ad.settings.attachLinkText+"</a>")}else{ad._exec("createlink","#xhedt_tempurl")}ao=h('a[href$="#xhedt_tempurl"]',L)}ad.attr(ao,"href",ar);if(ap.val()!=""){ao.attr("target",ap.val())}else{ao.removeAttr("target")}}ad.hidePanel();return false});ad.showDialog(an)};this.showImg=function(){var av=h(y);var ao=ad.getParent("img"),ap=h("#xhEdtImgSrc",av),aw=h("#xhEdtImgAlt",av),ay=h("#xhEdtImgAlign",av),aq=h("#xhEdtImgWidth",av),ar=h("#xhEdtImgHeight",av),ax=h("#xhEdtImgBorder",av),am=h("#xhEdtImgVspace",av),at=h("#xhEdtImgHspace",av),au=h("#xhEdtSave",av);if(ao.size()==1){ap.val(ad.attr(ao,"src"));aw.val(ao.attr("alt"));ay.val(ao.attr("align"));aq.val(ao.attr("width"));ar.val(ao.attr("height"));ax.val(ao.attr("border"));var an=ao.attr("vspace"),az=ao.attr("hspace");am.val(an<=0?"":an);at.val(az<=0?"":az)}if(ad.settings.upImgUrl){ad.ajaxUploadInit(ap,ad.settings.upImgUrl,ad.settings.upImgExt)}au.click(function(){ad.focus();var aB=ap.val();if(aB!=""&&aB!="http://"){aB=aB.split("|");if(ao.size()==0){ad.pasteHTML('<img src="#xhedt_tempurl" />');ao=h('img[src$="#xhedt_tempurl"]',L)}ad.attr(ao,"src",aB[0]);if(aw.val()!=""){ao.attr("alt",aw.val())}else{ao.removeAttr("alt")}if(ay.val()!=""){ao.attr("align",ay.val())}else{ao.removeAttr("align")}if(aq.val()!=""){ao.attr("width",aq.val())}else{ao.removeAttr("width")}if(ar.val()!=""){ao.attr("height",ar.val())}else{ao.removeAttr("height")}if(ax.val()!=""){ao.attr("border",ax.val())}else{ao.removeAttr("border")}if(am.val()!=""){ao.attr("vspace",am.val())}else{ao.removeAttr("vspace")}if(at.val()!=""){ao.attr("hspace",at.val())}else{ao.removeAttr("hspace")}if(aB[1]){var aA=ao.parent("a");if(aA.size()==0){ao.wrap("<a></a>");aA=ao.parent("a")}ad.attr(aA,"href",aB[1]);aA.attr("target","_blank")}}else{if(ao.size()==1){ao.remove()}}ad.hidePanel();return false});ad.showDialog(av)};this.showFlash=function(){var ao=h(H);var ap=ad.getParent('embed[type="application/x-shockwave-flash"]'),ar=h("#xhEdtFlashSrc",ao),aq=h("#xhEdtFlashWidth",ao),am=h("#xhEdtFlashHeight",ao),an=h("#xhEdtSave",ao);if(ap.size()==1){ar.val(ad.attr(ap,"src"));aq.val(ap.attr("width"));am.val(ap.attr("height"))}if(ad.settings.upFlashUrl){ad.ajaxUploadInit(ar,ad.settings.upFlashUrl,ad.settings.upFlashExt)}an.click(function(){ad.focus();var au=ar.val();if(au!=""&&au!="http://"){if(ap.size()==0){ad.pasteHTML('<embed type="application/x-shockwave-flash" src="#xhedt_tempurl" wmode="opaque" quality="high" bgcolor="#ffffff" menu="false" play="true" loop="true" />');ap=h('embed[src$="#xhedt_tempurl"]',L)}ad.attr(ap,"src",au);var at=aq.val(),aw=am.val(),av=/^[0-9]+$/;if(!av.test(at)){at=412}if(!av.test(aw)){aw=300}ap.attr("width",at);ap.attr("height",aw)}else{if(ap.size()==1){ap.remove()}}ad.hidePanel();return false});ad.showDialog(ao)};this.showMeida=function(){var ar=h(x);var ao=ad.getParent('embed[type="application/x-mplayer2"]'),aq=h("#xhEdtMediaSrc",ar),ap=h("#xhEdtMediaWidth",ar),am=h("#xhEdtMediaHeight",ar),an=h("#xhEdtSave",ar);if(ao.size()==1){aq.val(ad.attr(ao,"src"));ap.val(ao.attr("width"));am.val(ao.attr("height"))}if(ad.settings.upMediaUrl){ad.ajaxUploadInit(aq,ad.settings.upMediaUrl,ad.settings.upMediaExt)}an.click(function(){ad.focus();var au=aq.val();if(au!=""&&au!="http://"){if(ao.size()==0){ad.pasteHTML('<embed type="application/x-mplayer2" src="#xhedt_tempurl" enablecontextmenu="false" autostart="false" />');ao=h('embed[src$="#xhedt_tempurl"]',L)}ad.attr(ao,"src",au);var at=ap.val(),aw=am.val(),av=/^[0-9]+$/;if(!av.test(at)){at=412}if(!av.test(aw)){aw=300}ao.attr("width",at);ao.attr("height",aw)}else{if(ao.size()==1){ao.remove()}}ad.hidePanel();return false});ad.showDialog(ar)};this.ajaxUploadInit=function(ap,an,aq){var ao='<span class="upload"><input type="text" style="visibility:hidden;" /><input type="button" value="上传" class="btn" />',am;if(an.substr(0,1)=="!"){am=h(ao+"</span>");ap.after(am);h(".btn",am).before(ap).click(function(){ad.showIframeModal(an.substr(1),"上传文件",function(at){if(at.substr(0,1)=="!"){ap.val(at.substr(1));ap.closest(".xhEdtDialog").find("#xhEdtSave").click()}else{ap.val(at)}})})}else{am=h(ao+'<input type="file" class="file" size="13" name="upload" id="xhEdtUploadFile" /></span>');ap.after(am);h(".btn",am).before(ap);var ar=h("#xhEdtUploadFile",am);ar.change(function(){var au=ar.val();if(au!=""){if(au.match(new RegExp(".("+aq.replace(/,/g,"|")+")$","i"))){var at=ad.showModal("文件上传",'<div style="margin:22px 0;text-align:center;line-height:30px;">文件上传中，请稍候……<br /><img src="'+J+'img/loading.gif"></div>',320,150);ad.ajaxUpload(ar,an,function(av){at.unloadme();if(av.err){alert(av.err)}else{var aw=av.msg;if(aw.substr(0,1)=="!"){ap.val(aw.substr(1));ap.closest(".xhEdtDialog").find("#xhEdtSave").click()}else{ap.val(aw)}}})}else{alert("上传文件扩展名必需为："+aq)}}})}};this.ajaxUpload=function(ap,am,au){var at=new Date().getTime(),ar="jUploadFrame"+at;var an=h('<iframe name="'+ar+'" class="xhEdtUploadIO" />').appendTo("body");var ao=h('<form action="'+am+'" target="'+ar+'" method="post" enctype="multipart/form-data" class="xhEdtUploadForm"></form>').appendTo("body");var av=h(ap),aq=av.clone().attr("disabled","true");av.before(aq).appendTo(ao);ao.submit();an.load(function(){setTimeout(function(){aq.before(av).remove();an.remove();ao.remove()},100);var aw=h(an[0].contentWindow.document.body).text(),ay=Object;try{eval("data="+aw)}catch(ax){}if(data.err!=undefined&&data.msg!=undefined){au(data)}else{alert(am+" 上传接口有错误")}})};this.showIframeModal=function(ar,aq,at,am,ao){var an=h('<iframe frameborder="0" src="'+ar+'" style="width:100%;" />');var ap=ad.showModal(aq,an,am,ao);an.load(function(){var au=an[0].contentWindow;au.callback=at;au.unloadme=ap.unloadme})};this.showModal=function(au,ar,an,aq,am){var ap=h('<div class="xhEdtOverlay"></div>').appendTo("body").mousedown(function(){return false});an=an?an:ad.settings.modalWidth;aq=aq?aq:ad.settings.modalHeight;var at=h('<div class="xhEdtModal" style="width:'+an+"px;height:"+aq+"px;margin:-"+Math.ceil(aq/2)+"px 0px 0px -"+Math.ceil(an/2)+'px;">'+(ad.settings.modalTitle?'<div class="xhEdtTitle"><span class="xhEdtClose" title="关闭"></span>'+au+"</div>":"")+'<div class="xhEdtContent"></div></div>').appendTo("body").mousedown(function(){return false});var ao=h('<div class="xhEdtModalShadow" style="width:'+an+"px;height:"+aq+"px;margin:-"+(Math.ceil(aq/2)-5)+"px 0px 0px -"+(Math.ceil(an/2)-5)+'px;"></div>').appendTo("body").mousedown(function(){return false});this.unloadme=function(){at.remove();ao.remove();ap.remove();if(am){am()}};h(".xhEdtClose",at).click(this.unloadme);h(".xhEdtContent",at).html(ar);ap.show();ao.show();at.show();return this};this.showEmot=function(){var aq=h('<div class="xhEdtEmot"></div>'),ao,am,ap=0,an=C+"xheditor_emot/default/";ao=h("<div></div>");h.each(n,function(at,ar){ap++;am=h('<a href="javascript:void(0);" title="'+ar.t+'"><img src="'+an+ar.s+'" /></a>').click(function(){ad.focus();ad.pasteHTML('<img src="'+an+ar.s+'" alt="'+ar.t+'">');ad.hidePanel()}).mousedown(function(){return false});ao.append(am);if(ap%6==0){aq.append(ao);ao=h("<div></div>")}});aq.append(ao);ad.showPanel(aq)};this.showTable=function(){var an=h(g);var am=h("#xhEdtTableRows",an),ay=h("#xhEdtTableColumns",an),av=h("#xhEdtTableHeaders",an),ap=h("#xhEdtTableWidth",an),aq=h("#xhEdtTableHeight",an),ax=h("#xhEdtTableBorder",an),ao=h("#xhEdtTableCellSpacing",an),at=h("#xhEdtTableCellPadding",an),aw=h("#xhEdtTableAlign",an),ar=h("#xhEdtTableCaption",an),au=h("#xhEdtSave",an);au.click(function(){ad.focus();var aL=ar.val(),aK=ax.val(),aD=am.val(),az=ay.val(),aB=av.val(),aA=ap.val(),aH=aq.val(),aF=ao.val(),aI=at.val(),aJ=aw.val();var aG,aE,aC="<table"+(aK!=""?' border="'+aK+'"':"")+(aA!=""?' width="'+aA+'"':"")+(aH!=""?' width="'+aH+'"':"")+(aF!=""?' cellspacing="'+aF+'"':"")+(aI!=""?' cellpadding="'+aI+'"':"")+(aJ!=""?' align="'+aJ+'"':"")+">";if(aL!=""){aC+="<caption>"+aL+"</caption>"}if(aB=="row"||aB=="both"){aC+="<tr>";for(aG=0;aG<az;aG++){aC+='<th scope="col">&nbsp;</th>'}aC+="</tr>";aD--}aC+="<tbody>";for(aG=0;aG<aD;aG++){aC+="<tr>";for(aE=0;aE<az;aE++){if(aE==0&&(aB=="col"||aB=="both")){aC+='<th scope="row">&nbsp;</th>'}else{aC+="<td>&nbsp;</td>"}}aC+="</tr>"}aC+="</tbody></table>";ad.pasteHTML(aC);ad.hidePanel();return false});ad.showDialog(an)};this.showAbout=function(){var an=h(q);var am=h("#xhEdtSave",an);am.click(function(){ad.focus();ad.hidePanel();return false});ad.showDialog(an)};this.showDialog=function(an){var am=h('<div class="xhEdtDialog"></div>');am.append(an);ad.showPanel(am)};this.showPanel=function(an){if(t){ad.hidePanel()}d.empty().append(an).css("left",0).css("top",0);j=h(ai.target).closest("a");var ao=j.offset();var am=ao.left,ap=ao.top;ap+=j.height();j.addClass("xhEdtActive");p.css({left:am+1,top:ap}).show();if((am+d.width())>document.body.clientWidth){am-=(d.width()-j.width())}B.css({left:am+3,top:ap+3,width:d.width(),height:d.height()}).show();d.css("left",am).css("top",ap).show();if(r&&!P){S=ad.getRng()}t=true};this.hidePanel=function(){if(t){j.removeClass("xhEdtActive");B.hide();p.hide();d.hide();S=null;t=false}};this.exec=function(ap){var ar=v[ap].e;if(ar){return ar.call(this)}ap=ap.toLowerCase();switch(ap){case"cut":try{L.execCommand(ap);if(!L.queryCommandSupported(ap)){throw"Error"}}catch(ao){alert("您的浏览器安全设置不允许使用剪切操作，请使用键盘快捷键(Ctrl + X)来完成")}break;case"copy":try{L.execCommand(ap);if(!L.queryCommandSupported(ap)){throw"Error"}}catch(ao){alert("您的浏览器安全设置不允许使用复制操作，请使用键盘快捷键(Ctrl + C)来完成")}break;case"paste":try{L.execCommand(ap);if(!L.queryCommandSupported(ap)){throw"Error"}}catch(ao){alert("您的浏览器安全设置不允许使用粘贴操作，请使用键盘快捷键(Ctrl + V)来完成")}break;case"pastetext":if(window.clipboardData){ad.pasteText(window.clipboardData.getData("Text",true))}else{ad.showPastetext()}break;case"blocktag":var aq=[];h.each(A,function(au,at){aq.push({s:"<"+at.n+">"+at.t+"</"+at.n+">",v:"<"+at.n+">",t:at.t})});ad.showMenu(aq,function(at){ad._exec("formatblock",at)});break;case"fontface":var am=[];h.each(c,function(au,at){am.push({s:'<span style="font-family:'+at+'">'+at+"</span>",v:at,t:at})});ad.showMenu(am,function(at){ad._exec("fontname",at)});break;case"fontsize":var an=[];h.each(w,function(au,at){an.push({s:'<span style="font-size:'+at.s+'">'+at.t+"("+at.s+")</span>",v:au+1,t:at.t})});ad.showMenu(an,function(at){ad._exec("fontsize",at)});break;case"fontcolor":ad.showColor(function(at){ad._exec("forecolor",at)});break;case"backcolor":ad.showColor(function(at){if(r){ad._exec("backcolor",at)}else{ad.setCSS(true);ad._exec("hilitecolor",at);ad.setCSS(false)}});break;case"align":ad.showMenu(e,function(at){ad._exec(at)});break;case"list":ad.showMenu(f,function(at){ad._exec(at)});break;case"link":ad.showLink();break;case"img":ad.showImg();break;case"flash":ad.showFlash();break;case"media":ad.showMeida();break;case"emot":ad.showEmot();break;case"table":ad.showTable();break;case"source":ad.toggleSource();break;case"preview":ad.togglePreview();break;case"fullscreen":ad.toggleFullscreen();break;case"about":ad.showAbout();break;default:ad._exec(ap);break}};this._exec=function(am,an){if(an!=undefined){return L.execCommand(am,false,an)}else{return L.execCommand(am,false,null)}}};h(function(){h("textarea.xheditor").xheditor(true);h("textarea.xheditor-mini").xheditor(true,{tools:"mini"});h("textarea.xheditor-simple").xheditor(true,{tools:"simple"})})})(jQuery);