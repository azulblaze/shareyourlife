<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="goods_price">
  <resultMap class="com.zhelazhela.db.model.GoodsPrice" id="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Feb 14 23:42:49 CST 2010.
    -->
    <result column="id" jdbcType="BIGINT" property="id" />
    <result column="good_id" jdbcType="BIGINT" property="goodId" />
    <result column="SN" jdbcType="VARCHAR" property="sn" />
    <result column="provide_user_id" jdbcType="BIGINT" property="provideUserId" />
    <result column="price" jdbcType="REAL" property="price" />
    <result column="topic" jdbcType="VARCHAR" property="topic" />
    <result column="status" jdbcType="INTEGER" property="status" />
  </resultMap>
  <resultMap id="define_UserPriceMap" class="com.zhelazhela.db.model.define.UserPrice">
    <result column="id" jdbcType="BIGINT" property="id" />
    <result column="goods_id" jdbcType="BIGINT" property="goods_id" />
    <result column="user_id" jdbcType="BIGINT" property="user_id" />
    <result column="goods_sn" jdbcType="VARCHAR" property="goods_sn" />
    <result column="user_name" jdbcType="VARCHAR" property="user_name" />
    <result column="user_avatar" jdbcType="VARCHAR" property="user_avatar" />
    <result column="price" jdbcType="REAL" property="price" />
    <result column="topic" jdbcType="VARCHAR" property="topic" />
    <result column="cert_id" jdbcType="BIGINT" property="cert_id" />
    <result column="cert_name" jdbcType="VARCHAR" property="cert_name" />
    <result column="cert_icon" jdbcType="VARCHAR" property="cert_icon" />
    <result column="cert_description" jdbcType="VARCHAR" property="cert_description" />
    <result column="cert_parameter" jdbcType="VARCHAR" property="cert_parameter" />
    <result column="cert_date" property="cert_date" jdbcType="TIMESTAMP" />
    <result property="priceaddr" select="selectPriceAddrById"/>
  </resultMap>
  <resultMap id="define_UserPriceAddrMap" class="com.zhelazhela.db.model.define.UserPriceAddr">
    <result column="buy_addr_id" jdbcType="BIGINT" property="buy_addr_id" />
    <result column="price_id" jdbcType="BIGINT" property="price_id" />
    <result column="addr_type" jdbcType="INTEGER" property="addr_type" />
    <result column="buy_link" jdbcType="VARCHAR" property="buy_link" />
    <result column="buy_country" jdbcType="VARCHAR" property="buy_country" />
    <result column="buy_state_province" jdbcType="VARCHAR" property="buy_state_province" />
    <result column="buy_city" jdbcType="VARCHAR" property="buy_city" />
    <result column="buy_addr" jdbcType="VARCHAR" property="buy_addr" />
    <result column="addr_status" jdbcType="INTEGER" property="addr_status" />
    <result column="longitude" jdbcType="REAL" property="longitude" />
    <result column="latitude" jdbcType="REAL" property="latitude" />
  </resultMap>
  <sql id="ibatorgenerated_Example_Where_Clause">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Feb 14 23:42:49 CST 2010.
    -->
    <iterate conjunction="or" prepend="where" property="oredCriteria" removeFirstPrepend="iterate">
      <isEqual compareValue="true" property="oredCriteria[].valid">
        (
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithoutValue">
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithSingleValue">
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithListValue">
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate close=")" conjunction="," open="(" property="oredCriteria[].criteriaWithListValue[].values">
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithBetweenValue">
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="ibatorgenerated_selectByExample" parameterClass="com.zhelazhela.db.model.GoodsPriceExample" resultMap="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Feb 14 23:42:49 CST 2010.
    -->
    select id, good_id, SN, provide_user_id, price, topic, status
    from goods_price
    <isParameterPresent>
      <include refid="goods_price.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause">
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <select id="ibatorgenerated_selectByPrimaryKey" parameterClass="com.zhelazhela.db.model.GoodsPrice" resultMap="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Feb 14 23:42:49 CST 2010.
    -->
    select id, good_id, SN, provide_user_id, price, topic, status
    from goods_price
    where id = #id:BIGINT#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.zhelazhela.db.model.GoodsPrice">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Feb 14 23:42:49 CST 2010.
    -->
    delete from goods_price
    where id = #id:BIGINT#
  </delete>
  <delete id="ibatorgenerated_deleteByExample" parameterClass="com.zhelazhela.db.model.GoodsPriceExample">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Feb 14 23:42:49 CST 2010.
    -->
    delete from goods_price
    <include refid="goods_price.ibatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.zhelazhela.db.model.GoodsPrice">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Feb 14 23:42:49 CST 2010.
    -->
    insert into goods_price (id, good_id, SN, provide_user_id, price, topic, status)
    values (#id:BIGINT#, #goodId:BIGINT#, #sn:VARCHAR#, #provideUserId:BIGINT#, #price:REAL#,
      #topic:VARCHAR#, #status:INTEGER#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.zhelazhela.db.model.GoodsPrice">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Feb 14 23:42:49 CST 2010.
    -->
    insert into goods_price
    <dynamic prepend="(">
      <isNotNull prepend="," property="id">
        id
      </isNotNull>
      <isNotNull prepend="," property="goodId">
        good_id
      </isNotNull>
      <isNotNull prepend="," property="sn">
        SN
      </isNotNull>
      <isNotNull prepend="," property="provideUserId">
        provide_user_id
      </isNotNull>
      <isNotNull prepend="," property="price">
        price
      </isNotNull>
      <isNotNull prepend="," property="topic">
        topic
      </isNotNull>
      <isNotNull prepend="," property="status">
        status
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(">
      <isNotNull prepend="," property="id">
        #id:BIGINT#
      </isNotNull>
      <isNotNull prepend="," property="goodId">
        #goodId:BIGINT#
      </isNotNull>
      <isNotNull prepend="," property="sn">
        #sn:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="provideUserId">
        #provideUserId:BIGINT#
      </isNotNull>
      <isNotNull prepend="," property="price">
        #price:REAL#
      </isNotNull>
      <isNotNull prepend="," property="topic">
        #topic:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="status">
        #status:INTEGER#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <select id="ibatorgenerated_countByExample" parameterClass="com.zhelazhela.db.model.GoodsPriceExample" resultClass="java.lang.Integer">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Feb 14 23:42:49 CST 2010.
    -->
    select count(*) from goods_price
    <include refid="goods_price.ibatorgenerated_Example_Where_Clause" />
  </select>
  <update id="ibatorgenerated_updateByExampleSelective">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Feb 14 23:42:49 CST 2010.
    -->
    update goods_price
    <dynamic prepend="set">
      <isNotNull prepend="," property="record.id">
        id = #record.id:BIGINT#
      </isNotNull>
      <isNotNull prepend="," property="record.goodId">
        good_id = #record.goodId:BIGINT#
      </isNotNull>
      <isNotNull prepend="," property="record.sn">
        SN = #record.sn:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.provideUserId">
        provide_user_id = #record.provideUserId:BIGINT#
      </isNotNull>
      <isNotNull prepend="," property="record.price">
        price = #record.price:REAL#
      </isNotNull>
      <isNotNull prepend="," property="record.topic">
        topic = #record.topic:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.status">
        status = #record.status:INTEGER#
      </isNotNull>
    </dynamic>
    <isParameterPresent>
      <include refid="goods_price.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByExample">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Feb 14 23:42:49 CST 2010.
    -->
    update goods_price
    set id = #record.id:BIGINT#,
      good_id = #record.goodId:BIGINT#,
      SN = #record.sn:VARCHAR#,
      provide_user_id = #record.provideUserId:BIGINT#,
      price = #record.price:REAL#,
      topic = #record.topic:VARCHAR#,
      status = #record.status:INTEGER#
    <isParameterPresent>
      <include refid="goods_price.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.zhelazhela.db.model.GoodsPrice">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Feb 14 23:42:49 CST 2010.
    -->
    update goods_price
    <dynamic prepend="set">
      <isNotNull prepend="," property="goodId">
        good_id = #goodId:BIGINT#
      </isNotNull>
      <isNotNull prepend="," property="sn">
        SN = #sn:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="provideUserId">
        provide_user_id = #provideUserId:BIGINT#
      </isNotNull>
      <isNotNull prepend="," property="price">
        price = #price:REAL#
      </isNotNull>
      <isNotNull prepend="," property="topic">
        topic = #topic:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="status">
        status = #status:INTEGER#
      </isNotNull>
    </dynamic>
    where id = #id:BIGINT#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.zhelazhela.db.model.GoodsPrice">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Feb 14 23:42:49 CST 2010.
    -->
    update goods_price
    set good_id = #goodId:BIGINT#,
      SN = #sn:VARCHAR#,
      provide_user_id = #provideUserId:BIGINT#,
      price = #price:REAL#,
      topic = #topic:VARCHAR#,
      status = #status:INTEGER#
    where id = #id:BIGINT#
  </update>
  
  <select id="selectUserPriceByGoods" parameterClass="java.util.Map" resultMap="define_UserPriceMap">
    select gp.id as id,gp.good_id as goods_id,gp.SN as goods_sn,gp.provide_user_id as user_id, ui.name as user_name,ui.avatar as user_avatar,gp.price as price,gp.topic as topic,cc.id as cert_id,cc.name as cert_name,cc.icon as cert_icon,cc.description as cert_description,IFNULL(uc.parameter,'') as cert_parameter,uc.start_date as cert_date  
    from goods_price gp 
    left join userinfo ui on gp.provide_user_id = ui.user_id 
    left join user_certification uc on gp.provide_user_id = uc.user_id and uc.cert_id =1 and (uc.end_date is null or uc.end_date &lt; CURRENT_TIMESTAMP) 
    left join certification cc on cc.id = uc.cert_id 
    order by cert_parameter DESC;
  </select>
  
  <select id="selectPriceAddrById" parameterClass="java.lang.Long" resultMap="define_UserPriceMap">
    select id as  buy_addr_id,goods_price_id as price_id,addr_type,buy_link,buy_country,buy_state_province,buy_city,buy_addr,status as addr_status,longitude,latitude 
    from goods_sell_addr 
    where goods_price_id = #id:BIGINT#
  </select>
</sqlMap>